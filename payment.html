<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
	* {
		box-sizing: border-box;
	}

	body {
		background-color: black;
		margin: 0;
	}
	
	/*Created a header container to hold buttons at the top*/
	.header {
		padding: 10px;
		<!-- background-color: blue; -->
		margin: 0px 0px 0px;
	}
	
	/*Button group for creating the buttons at top of page*/
	/*Same button group from the main page*/
	.button-group button {
		background-color: #D3D3D3; /*Makes Gray background*/
		border:  0px #D3D3D3;  /*Border around boxes is Gray*/
		color: black; /* White text */
		padding: 10px 10px; /* Some padding */
		margin: 0;  /* Created space between buttons */
		font-family: Arial Black, Times, serif; /* sets font */
		font-size:  16px;	/* Sets size */
		font-weight:  normal;	/*Sets normal or bold */
		text-align: center;	/* Aligns to center of button */
		cursor: pointer; /* Pointer/hand icon */
		width: 15%; /* Set a width if needed */
		display: inline-block;
	}

	.button-group button:not(:last-child) {
		border-right: none; /* Prevent double borders */
	}

	/* Add a background color on hover */
	.button-group button:hover {
		background-color: #3e8e41;
	}
	
	.column-left {
		background-color: #A9A9A9 !important; //makes Gray background
		padding: 1%;
		margin: 1%;
		width: 50%;
		height: 95%;
		left: .5%;
		display: inline-block;
		text-align:;
		position: absolute;
	}
	
	.column-right {
		background-color: #A9A9A9 !important; //makes Gray background
		padding: 1%;
		margin: 1%;
		width: 35%;
		height: 95%;
		right: .5%;
		display: inline-block;
		text-align: center;
		position: absolute;
	}
	
	.row:after {
		content: "";
		display: table;
		clear: both;
	}
	
	/*Adding to left container*/
	/*Add buttons to the left container*/
	.button-group2 button {
		background-color: black; /*Makes Gray background*/
		border:  1% #D3D3D3;  /*Border around boxes is Gray*/
		color: white; /* White text */
		padding: 20px 50px; /* Some padding */
		margin: 17px;  /* Created space between buttons */
		margin-left: 15%;
		font-family: Arial Black, Times, serif; /* sets font */
		font-size:  20px;	/* Sets size */
		font-weight:  normal;	/*Sets normal or bold */
		text-align: center;	/* Aligns to center of button */
		cursor: pointer; /* Pointer/hand icon */
		width: 65%; /* Set a width if needed */
		display: block;
	}

	.button-group2 button:not(:last-child) {
		border-right: none; /* Prevent double borders */
	}

	/* Add a background color on hover */
	.button-group2 button:focus {
		background-color: green;
	}
	
	.add-tip button{
		background-color: black; /*Makes Gray background*/
		border:  1% #D3D3D3;  /*Border around boxes is Gray*/
		color: white; /* White text */
		padding: 20px 10px; /* Some padding */
		margin-left: 13%;  /* Created space between buttons */
		font-family: Arial Black, Times, serif; /* sets font */
		font-size:  12px;	/* Sets size */
		font-weight:  normal;	/*Sets normal or bold */
		text-align: center;	/* Aligns to center of button */
		cursor: pointer; /* Pointer/hand icon */
		width: 18%; /* Set a width if needed */
		display: inline-block;
		margin-top: 0%;
		margin-left: 75%;
		bottom: 20%;
		position: absolute;
	}
	
	
	/* Add a background color on click */
	.add-tip button:focus {
		background-color: green;
	}
	
	.rewards-button button {
		background-color: black; /*Makes Gray background*/
		border:  1% #D3D3D3;  /*Border around boxes is Gray*/
		color: white; /* White text */
		padding: 20px 10px; /* Some padding */
		margin-left: 13%;  /* Created space between buttons */
		font-family: Arial Black, Times, serif; /* sets font */
		font-size:  12px;	/* Sets size */
		font-weight:  normal;	/*Sets normal or bold */
		text-align: center;	/* Aligns to center of button */
		cursor: pointer; /* Pointer/hand icon */
		width: 30%; /* Set a width if needed */
		display: inline-block;
	}

	/* Add a background color on click */
	.rewards-button button:focus {
		background-color: green;
	}
	

	/*Create an input for tips*/
	input {
		margin: 10px 60px;
		width: 150px;
	}

	label {
		margin: 0px 0px 0px;
	}
	
	h2 {
		margin: 30px;
		text-align: center;
	}
	
	@media screen and (max-width: 600px){
		.column {
			width: 100%;
		}
	}
	
	.slidecontainer {
		float: left;
		width: 100%;
		background-color: none;
		margin: 0 auto;
		right: 0%;
		text-indent: 5%;
	}

	.slider {
		-webkit-appearance: none;
		width: 50%;
		height: 25px;
		background: #d3d3d3;
		position: absolute;
		left: 15%;
		outline: none;
		opacity: 1;
		-webkit-transition: .2s;
		transition: opacity .2s;
	}

	.slider:hover {
		opacity: 1;
	}

	.slider::-webkit-slider-thumb {
		-webkit-appearance: none;
		appearance: none;
		width: 25px;
		height: 25px;
		background: #4CAF50;
		cursor: pointer;
	}

	.slider::-moz-range-thumb {
		width: 25px;
		height: 25px;
		background: #4CAF50;
		cursor: pointer;
	}
	
	/* Add styles to the form container */
	.split-pay-container {
		max-width: 500px;
		padding: 10px;
		background-color: white;
	}
	
	/* Rewards member popup*/
	.rewards-login {
		display: none;
		position: fixed;
		bottom: 35%;
		right: 35%;
		border: 3px solid #f1f1f1;
		z-index: 9;
	}

	/* Add styles to the form container */
	.form-container {
		max-width: 300px;
		padding: 10px;
		background-color: green;
	}

	.form-container input[type=text], .form-container input[type=password] {
		width: 100%;
		padding: 15px;
		margin: 5px 0 22px 0;
		border: none;
		background: #f1f1f1;
	}

	.form-container input[type=text]:focus, .form-container input[type=password]:focus {
		background-color: #ddd;
		outline: none;
	}

	/* Set a style for the submit/login button */
	.form-container .button {
		background-color: gray;
		color: white;
		padding: 16px 20px;
		border: none;
		cursor: pointer;
		width: 100%;
		margin-bottom:10px;
		opacity: 0.8;
	}


	.form-container .cancel {
		background-color: gray;
	}

	.form-container .button:hover, .open-button:hover {
		opacity: 1;
	}

	
</style>

	<link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet'>
    <!--changed to https://... below to remove error-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
	function setup() {
		var toggle = {
			type: "show"
		};
		parent.window.postMessage(toggle, "*");
	}
	
	function goRewards() {
		var message = {
			type: "rewards"
		}
		parent.window.postMessage(message, "*");
		document.location = 'customer/rewards.html';
	}

	function updateReceipt(order){
		//console.log("Updating receipt");
		//console.log(order);
		var target = document.getElementById("receipt_screen");
		order.items.forEach(items =>
			target.contentWindow.postMessage(items, '*')
		);
	}
	
	function sendTip(){
		//var x = document.getElementById("myRange");
		//var x = 20;
		var tip = 20;
		var target = document.getElementById("receipt_screen");
		console.log("Sending tip");
		//console.log(target.contentWindow.postMessage(tip, '*'));
	}
	
	$(document).ready(function() {
		var queryStr = window.location.search;
		var category = queryStr.substr(1)
		var url = "http://159.89.238.181:8080/api/orders?".concat(category);
		$.ajax({
			url: url,
			type: 'get',
			dataType: 'JSON',
			success: function(response) {
				console.log(response[0]);
				updateReceipt(response[0]); // just the first order we get			
			}
		});
	});
	
	function openFormSplit() {
		document.getElementById("split").style.display = "block";
	}
	
	function openFormRewards() {
		document.getElementById("myForm").style.display = "block";
	}

	function closeFormRewards() {
		document.getElementById("myForm").style.display = "none";
	}
	
	function getRewards(){
		var phone = document.getElementById("phone").value;
		var today = new Date();
		var month, day, year;
		if(today.getMonth()+1 < 10)
		{
			month = today.getMonth()+1;
			month = "0" + month;
		}
		else
		{
			month = today.getMonth()+1;
		}
		if(today.getDate() < 10)
		{
			day= "0" + today.getDate();
		}
		else
		{
			day = today.getDate();
		}
		
		var noPhone = document.getElementById("noPhone");
		var numVisits = document.getElementById("numVisits");	
		noPhone.innerHTML="";
		numVisits.innerHTML="";
		
		var url = "http://159.89.238.181:8080/api/customers/?phone=";
		url = url.concat(phone);
		$.get(url, function(response){
			if(response == "No entries found"){
				noPhone.innerHTML = "No rewards account found.";
				numVisits.innerHTML = "";
			}
			else{
				noPhone.innerHTML="";
				response = JSON.parse(response);
				var birthday = response[0].bday.split('-');
				var visits = response[0].visits;
				visits ++;
				visits = visits%5;
				if(month == birthday[1] && day == birthday[2])
				{
					var birthday = document.getElementById("birthday");
					birthday.innerHTML = "Happy birthday! Check your email for a free dessert!";
				}
				if(visits == 0)
				{
					numVisits.innerHTML = "You have earned a free dessert! Check your email for your coupon on your next visit!";
				}
				else
				{
					numVisits.innerHTML = "You have " + visits + " visits. On your fifth visit, get emailed a coupon for a free dessert!";
				}
				$.post(url, function(response){
					response = JSON.parse(response);
					console.log(response);
					if(response.code == 200)
					{
						var login = document.getElementById("login");
						login.style.display="none";
					}
				});
			}
		});
	}
</script>
</head>

<body onload="setup()">
<div class="row">
	<div class="column-left">
		<h2>PAYMENT METHOD</h2>

		<div class="button-group2">
			<button onclick="">CARD</button>
			<button onclick="">CASH</button>
			<button id="split" onclick="openFormSplit()">SPLIT</button>
		</div>
		
		
		<!--Rewards Option-->
		<h2>REWARDS</h2>
		<div class="addRewards">
			<div class="rewards-button">
				<button onclick="goRewards()">SIGN UP</button>
				<button onclick="openFormRewards()">CURRENT MEMBER</button>
			</div>
		</div>
		
		<div class="rewards-login" id="myForm">
			<form class="form-container">
				<h1>Member Login</h1>

				<label for="email"><b>Phone Number</b></label>
				<input type="number" placeholder="1234567890" id="phone" required>

				<p id = "noPhone"></p>
				<p id = "numVisits"></p>
				<p id = "birthday"></p>
				<span id = "login">
					<button type="button" class="button" onclick="getRewards()">Login</button>
				</span>
				<button type="button" class="button cancel" onclick="closeFormRewards()">Close</button>
			</form>
		</div>
		
	</div>
	
	<div class="column-right">
		<h2>RECEIPT</h2>
		
		<!--Insert an iframe for the receipt-->
		<iframe id="receipt_screen" src="customer/customer_receipt.html" style="width:95%; height:80%" ></iframe>
	</div>
</div>
</body>
</html>
