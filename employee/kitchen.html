<html style = "width: 100%; height: 100%">

<style>    
    body 
	{
		margin: 0;
	}
	
	.orders 
    {
        width: 100%; 
        height: 90%; 
        background-color: white;
        overflow-x:auto;
        overflow-y: hidden;
        white-space: nowrap;
    }

    .ticket 
    {
        width: 25%;
        height: 100%;
        background-color: lightgrey;        
        margin-right: 1vw;
        border-radius: 1vw;
        display: none;
    }    

    .ticket button
    {
        background-color: white;
        width: 33%;
        font-family: "Lato", Arial, sans-serif;
        color: black;
        border-radius:1vw;
    }

    .controls 
    {
        width: 100%; 
        height: 10%; 
        background-color: lightgrey;
    }

    .item 
    {
        display: none;
    }
</style>
<head>
	<link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet'>
    <!--changed to https://... below to remove error-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
        function addTicket(order)
        {
		
			//Started here
			console.log(JSON.stringify(order));
			//Stopped here
			
            var clone = $("#ticket_template").clone(true);
            clone.css('display', 'inline-block');
            clone.appendTo('.orders');
            
            if (order.items === undefined) {
                return clone;
            }
            order.items.forEach(item => 
                addItem(order)
            );
            
            return clone;
        }

        function addItem(ticket) 
        {
            var clone = $("#item_template").clone(true);
            clone.css('display', 'inline-block');
            console.log(clone.html());
            //ticket.find('.items').append(clone);
            return clone;
        }
		
		//Started here
		//Function to call a server to the kitchen
		function callWaiter()
		{
			var message = "Kitchen needs assistance";
			console.log(JSON.stringify(message));
			$.post("http://159.89.238.181:8080/api/staff/", JSON.stringify(message));
		}
		//Function to call a manager to the kitchen
		function callManager()
		{
		
		}
		//Function to mark the order complete
		function markComplete()
		{
			//currently deletes the column but when page refreshed they come back because remains stored in backend
			document.querySelector(".ticket").remove();
		}
		//Stopped here
        
        $(document).ready(function() {
            $.ajax({
                url: 'http://159.89.238.181:8080/api/orders/?status=0',
                type: 'get',
                dataType: 'JSON',
                success: function(response) {
                    response.forEach(order => 
                        addTicket(order)
                    );
                }
            })
        }); 

    </script>
    <div class = "ticket" id = "ticket_template">        
        <div class = "information" style = "height: 20%; background-color: navy; color:white">
            <div class = "row"> 
                <button id="callW" onclick="callWaiter()">Call waitstaff</button>
                <button id="callM">Call manager</button>
                <button id="complete" onclick="markComplete();">Complete</button>
            </div>
            <div class = "row">
                <p>ORDER #</p>
                <p>ORDERED AT  #</p>
                <p>TABLE #</p>
            </div>
			
        </div>
        
        <div class = "items" style = "height: 90%; background-color:lightgrey; overflow-x: hidden; overflow-y: scroll;">
			<p id="item_name"> Item Name </p>
			<p id="item_subs"> --Subs </p>
			<p id="known_allergies"> --Allergies </p>
			<br>
        </div>
    </div>

    <div class = "item" id = "item_template">       
        <p> THIS IS AN ITEM</p>
    </div>
</head>

<body>
    <div class = "orders">        
    </div>
    <div class = "controls">
    </div>
</body>
</html>