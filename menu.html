<!DOCTYPE html>

<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
	* {
		box-sizing: border-box;
	}

	body {
		background-color: white;
		margin: 0;
		font-family: Arial;
	}
	
	/*Created a header container to hold buttons at the top*/
	.header {
		padding: 1%;
		/* background-color: blue; */
		margin: 0%;
	}
	
	/*Button group for creating the buttons at top of page*/
	/*Same button group from the main page*/
	.button-group button {
		background-color: #FF7F7F;
		border:  0% #D3D3D3;  /*Border around boxes is Gray*/
		color: white; /* White text */
		padding: 1% 1%; /* Some padding */
		margin: 0%;  /* Created space between buttons */
		font-family: Arial Black, Times, serif; /* sets font */
		font-size:  16px;	/* Sets size */
		font-weight:  normal;	/*Sets normal or bold */
		text-align: center;	/* Aligns to center of button */
		cursor: pointer; /* Pointer/hand icon */
		width: 15vw; /* Set a width if needed */
		display: inline-block;
	}

	.button-group button:not(:last-child) {
		border-right: none; /* Prevent double borders */
	}

	/* Add a background color on hover */
	.button-group button:hover {
		background-color: #3e8e41;
	}
	
	/*Created a left container to hold buttons for the menu types*/
	.left-menu {
		background-color: #3EB375;
		padding: 1%;
		margin: 1% 1% 1%;
		position: relative;
		width: 20vw;
		height: 80vh;
		left: .5%;
		display: inline-block;
		color:white;
	}
	
	/*Created a menu button similar to header buttons*/
	.menu-button-group button {
		background-color: white; /*Makes Gray background*/
		border:  0% #D3D3D3;  /*Border around boxes is Gray*/
		color: black; /* White text */
		padding: 5% 2%; /* Some padding */
		margin: 0;  /* Created space between buttons */
		font-family: Arial Black, Times, serif; /* sets font */
		font-size:  16px;	/* Sets size */
		font-weight:  normal;	/*Sets normal or bold */
		text-align: center;	/* Aligns to center of button */
		cursor: pointer; /* Pointer/hand icon */
		width: 86%; /* Set a width if needed */
		display: inline-block;
		position: relative;
		left: 15px;
		top: 20px;
		bottom: 10px;
	}
	
	/* Add a background color on hover */
	.menu-button-group button:hover {
		background-color: #3e8e41;
	}
	
	/*Created a menu container to hold menu items*/
	.menu {
		background-color: #3EB375;
		padding: 0%;
		margin: 1%;
		width: 50vw;
		height: 95%;
		left: 21.5%;
		display: inline-block;
		text-align: center;
		position: absolute;
		color:white;
	}
	
	/*Created a order container to hold menu items*/
	.order {
		background-color: #3EB375;
		padding: 1%;
		margin: 1%;
		width: 24%;
		height: 95%;
		right: .5%;
		display: inline-block;
		text-align: center;
		position: absolute;
		color:white;
	}
	
	
	/* The Modal (background) */
.modal {
  display: none; /* Hidden by default */
  position: fixed; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content */
.modal-content {
  position: relative;
  background-color: #fefefe;
  margin: auto;
  padding: 0;
  border: 1px solid #888;
  width: 80%;
  box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
  -webkit-animation-name: animatetop;
  -webkit-animation-duration: 0.4s;
  animation-name: animatetop;
  animation-duration: 0.4s;
  color:black;
}

/* Add Animation */
@-webkit-keyframes animatetop {
  from {top:-300px; opacity:0} 
  to {top:0; opacity:1}
}

@keyframes animatetop {
  from {top:-300px; opacity:0}
  to {top:0; opacity:1}
}

/* The Close Button */
.close {
  color: white;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.modal-header {
  padding: 2px 16px;
  background-color: #5cb85c;
  color: white;
}

.modal-body {padding: 2px 16px;}

.modal-footer {
  padding: 2px 16px;
  background-color: #5cb85c;
  color: white;
}
	
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
	var modal;
	var span;
	function setup() {
		// Get the modal
		modal = document.getElementById("myModal");
		// Get the <span> element that closes the modal
		span = document.getElementsByClassName("close")[0];		
		// When the user clicks on <span> (x), close the modal
		span.onclick = function() {
			modal.style.display = "none";
		}
		var toggle = {
			type: "show"
		};
		parent.window.postMessage(toggle, "*");
	}

	<!--selects menu type and displays menu items of that type-->
	function menuType(mType) {	
		var t = document.getElementById("headerType");
		var frame = document.getElementById('order_items');
		if(mType === "drinks") {
			t.innerHTML = "BEVERAGES";
			frame.src = "menu_category.html?category=3";
		}
		else if(mType === "apps") {
			t.innerHTML = "APPETIZERS";
			frame.src = "menu_category.html?category=1";
		}
		else if(mType === "meals") {
			t.innerHTML = "ENTREES";
			frame.src = "menu_category.html?category=0";
		}
		else if(mType === "kids") {
			t.innerHTML = "KIDS MENU";
			frame.src = "menu_category.html?category=4";
		}
		else if(mType === "sweets") {
			t.innerHTML = "DESSERTS";
			frame.src = "menu_category.html?category=2";
		}
		else if(mType === "mealDeal"){
			t.innerHTML = "$5 MEAL DEAL";
			frame.src = "menu_category.html?category=5";
			document.getElementById('bvg_selector').style.display = "inline-block";
		}
	}
	
	window.addEventListener('message', updateModal, false);
	function updateModal(message) {
		if (typeof (message.data) == "number") { // skip instances where child of this frame wants something from grandparent (our frame)
			orderFrame.contentWindow.postMessage(message.data, '*'); // relay table number to child
			return;
		}
		modal.style.display = "block";
		var name = document.getElementById("itemName");
		name.innerHTML = message.data.name;
		var hot = document.getElementById("hotItem");
		if(message.data.hot)
		{
			hot.innerHTML = "HOT ITEM";
		}
		else
		{
			hot.innerHTML = "";
		}
		var body = document.getElementsByClassName("modal-body");
		body.innerHTML = message.data.description;
		
		var nutrition = document.getElementById("nutrition");
		nutrition.innerHTML = "Nutrition: " + message.data.nutrition;
		
		var ingre = document.getElementById("ingre");
		ingre.innerHTML = "";
		
		//Newest addition for the item selector category 5
		var cat_num = message.data.category;
		//console.log(cat_num);
		if(cat_num === 5){
			$(document).ready(function() {//gets all menu items in category 6 to the selector
				var url = "http://159.89.238.181:8080/api/items?category=6";
				var drinks;
				$.ajax({
					url: url,
					type: 'get',
					dataType: 'JSON',
					success: function(response) {
						response.forEach(item => 
							createSelector(item)  //send to the function
						);
						drinks = response;
					}
				});
			});
			
			//function will append the drinks from cat 6 here
			function createSelector(item){
				var element = document.getElementById('bvg_selector');
				element.setAttribute('class', item._id.$oid);
				
				var cat = document.createElement('option');
				cat.setAttribute('value',6);
				cat.text = item.name;
				
				element.appendChild(cat);
			}
		}
		else {
			document.getElementById("bvg_selector").style.display = "none";
		}
		
		if (message.data.ingredients != undefined) {
				ingre.innerHTML = "Contains: ";
				for(items in message.data.ingredients)
				{
					if(items != message.data.ingredients.length-1)
					{
						ingre.innerHTML += message.data.ingredients[items] + ", ";
					}
					else
					{
						ingre.innerHTML += message.data.ingredients[items];
					}
				}
		}
		
		if (message.data.imgPath != undefined) {
			var photo = document.getElementById("photo");
			photo.src = message.data.imgPath;
		}
		
		if (message.data.allergen != null && message.data.allergen != "") {
			var allergen = document.getElementById("allergy");
			console.log("Item contains allergen information");
			allergen.style.display = "block";
			allergen.innerHTML = 'Allergens include: ' + message.data.allergen;
		} else {
			var allergen = document.getElementById("allergy");
			allergen.style.display = "none";
			allergen.innerHTML ="";
		}		
		
		var desc = document.getElementById("desc");	
		desc.innerHTML="";
		
		if (message.data.description != undefined && message.data.category != 3 && message.data.description != "") {
			desc.innerHTML = "Description: " + message.data.description;
		}
		
		if (message.data.price != undefined) {
			var price = document.getElementById("price");		
			price.innerHTML = "$" + message.data.price.toFixed(2);
		}		
		
		var vegan = document.getElementById("vegan");
		if(message.data.vegan == true)
		{
			vegan.innerHTML = "Vegan";
			vegan.setAttribute("style","color:red");
		}
		else
		{
			vegan.innerHTML = "";
		}
		
		var vegetarian = document.getElementById("vegetarian");
		if(message.data.vegeration == true)
		{
			vegetarian.innerHTML = "Vegetarian";
			vegetarian.setAttribute("style","color:red");
		}
		else
		{
			vegetarian.innerHTML = "";
		}
		
		var submit = $("#addOrder");
		submit.unbind('click'); // remove any previous onclick listeners for this button		
		submit.click(function() { // when clicked, send a message to the customer_order frame				
			sendToOrder(message);
			modal = document.getElementById("myModal");
			modal.style.display = 'none';
		});
	}
	
	function sendToOrder(message){
		console.log("adding an item");
		var target = document.getElementById('orderFrame');
		target.contentWindow.postMessage(message.data, '*');
	}
	
	
	
	
</script>
</head>

<body style="background-color:Black;" onload="setup();">
	<!--has buttons for the menu types-->
	<div class = "left-menu">
		<div class="menu-button-group">
			<button onclick="menuType('drinks')">BEVERAGES</button>
			<br><br>
			<button onclick="menuType('apps')">APPETIZERS</button>
			<br><br>
			<button onclick="menuType('meals')">ENTREES</button>
			<br><br>
			<button onclick="menuType('kids')">KIDS MENU</button>
			<br><br>
			<button onclick="menuType('sweets')">DESSERTS</button>
			<br><br>
			<button onclick="menuType('mealDeal')">$5 MEAL DEAL</button>
			<br><br>
		</div>
	</div>
	<!--Stores menu items of menu type selected from the buttons, default is beverages-->
	<div class = "menu" id = "menuType">
		<h2 id = "headerType">BEVERAGES</h2>
		<hr color = "black">
		<body>
			<iframe id = "order_items" src="menu_category.html?category=3" onclick="updateModal(); " style="width:95%; height: 85%" ></iframe>
		</body>
		
		<!-- The Modal -->
		<div id="myModal" class="modal">
			<!-- Modal content -->
			<div class="modal-content">
			
				<div class="modal-header">
					<span class="close">&times;</span>
					<h2 id="itemName" style="display:inline">Item Name</h2>
					<h2 id="hotItem" style="color:red;display:inline"></h2>
				</div>
				<div class="modal-body">
					<img id = 'photo' src = "img/burger.jpg">
					<p>Price: <span id= "price"></span></p>
					<p id = "nutrition">Nutrition:</id>
					<p id = "desc">Description:</p>
					<p id = "ingre">Contains: </p>
					<p id = "allergy">Allergens Include: </p>
					<p id = "vegan"></p>
					<p id = "vegetarian"></p>
				</div>
				<div class="modal-footer">
					<select id="bvg_selector">
						
					</select>
					<button id="addOrder">Add To Order</h3>
				</div>
				
			</div>
		</div>
	</div>

	
<!--Stores div for order items-->
	<div class = "order">
		<h2 text-align="center">ORDER</h2>
		
		<hr color = "black">
		<!--form for known allergies so kitchen and waitstaff can keep track-->
		
		
		<iframe src="customer/customer_order.html" id="orderFrame" onclick="orderList();" style="width:95%; height: 60%"></iframe>
	</div>

	
</body>
</html>
